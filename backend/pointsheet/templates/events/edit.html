{% extends "app.html" %} {% block content %}
<div class="d-flex justify-content-between align-items-center">
  <h4 class="fw-light">Event Details</h4>
  <div class="pb-2">
    <button type="submit" class="btn btn-primary me-2">Save Changes</button>
    <a href="/events/{{ event.id }}/" class="btn btn-secondary">Cancel</a>
  </div>
</div>
<form
  hx-put="/events/{{ event.id }}/"
  hx-target="this"
  hx-swap="outerHTML"
  class="p-4"
>
  <fieldset class="row border p-2">
    <div class="row">
      <div class="col-6">
        <label for="title" class="form-label">Title</label>
        <input
          type="text"
          id="title"
          name="title"
          value="{{ event.title }}"
          class="form-control"
          required
        />
      </div>

      <!-- Track -->
      <div class="mb-3 col-6">
        <label for="track" class="form-label">Track</label>
        <input
          type="text"
          id="track"
          name="track"
          value="{{ event.track }}"
          class="form-control"
          required
        />
      </div>

      <!-- Start Date -->
      <div class="mb-3 col-6">
        <label for="starts_at" class="form-label">Start Date</label>
        <input
          type="datetime-local"
          id="starts_at"
          name="starts_at"
          value="{{ event.starts_at.strftime('%Y-%m-%dT%H:%M') }}"
          class="form-control"
          required
        />
      </div>

      <!-- End Date -->
      <div class="mb-3 col-6">
        <label for="ends_at" class="form-label">End Date</label>
        <input
          type="datetime-local"
          id="ends_at"
          name="ends_at"
          value="{{ event.ends_at.strftime('%Y-%m-%dT%H:%M') }}"
          class="form-control"
          required
        />
      </div>

      <!-- Status -->
      <div class="mb-3 col-4">
        <label for="status" class="form-label">Status</label>
        <select id="status" name="status" class="form-select">
          <option
            value="draft"
            {%
            if
            event.status=""
            ="draft"
            %}selected
            {%
            endif
            %}
          >
            Draft
          </option>
          <option
            value="published"
            {%
            if
            event.status=""
            ="published"
            %}selected{%
            endif
            %}
          >
            Published
          </option>
          <option
            value="cancelled"
            {%
            if
            event.status=""
            ="cancelled"
            %}selected{%
            endif
            %}
          >
            Cancelled
          </option>
          <option
            value="completed"
            {%
            if
            event.status=""
            ="completed"
            %}selected{%
            endif
            %}
          >
            Completed
          </option>
        </select>
      </div>
    </div>
  </fieldset>

  <fieldset class="row mt-4">
    <div class="mb-4 col-4">
      <h4 class="h4 fw-light">Participants</h4>
      <div id="drivers-list d-flex-inline flex-wrap">
        <ul class="list">
          <li>Driver 1</li>
          <li>Driver 2</li>
        </ul>
        {% if event.drivers %} {% for driver in event.drivers %}
        <div
          class="card-body d-flex justify-content-between align-items-center"
        >
          <span>{{ driver.name }}</span>
        </div>
        {% endfor %} {% else %}
        <p>No participants yet.</p>
        {% endif %}
      </div>
    </div>
    <div class="mb-4 col border-start px-4">
      <h4 class="fw-light h4">Schedule</h4>

      {% if event.schedule %}

      <table class="table table-hover shadow-sm">
        <thead>
          <tr>
            <th scope="col">#</th>
            <th scope="col">Name</th>
            <th scope="col">No. Of Laps</th>
            <th scope="col">Duration</th>
            <th scope="col">Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for schedule in event.schedule %}
          <tr>
            <td>{{ loop.index }}</td>
            <td>{{ schedule.type.value|capitalize }}</td>
            <td>{{ schedule.nbr_of_laps|default('-') }}</td>
            <td>{{ schedule.duration }}</td>
            <td>
              <button
                type="button"
                hx-put="/events/{{ event.id }}/schedules/{{ schedule.id }}/delete"
                hx-target="closest tr"
                class="btn btn-sm btn-primary"
              >
                <i class="bi bi-pen"></i>
              </button>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
      {% else %}
      <p class="text-muted">No Schedule set.</p>
      {% endif %}
    </div>
  </fieldset>
</form>
{% endblock %}
